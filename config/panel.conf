#!/bin/bash
# VIP-Autoscript Panel Configuration

# System Paths
#PANEL_ROOT="/etc/vip-autoscript-"  # REMOVED readonly
CONFIG_DIR="${PANEL_ROOT}/config"
LIB_DIR="${PANEL_ROOT}/lib"
CLI_DIR="${PANEL_ROOT}/cli"
SCRIPTS_DIR="${PANEL_ROOT}/scripts"
USER_DIR="${PANEL_ROOT}/users"
LOG_DIR="${PANEL_ROOT}/logs"
BACKUP_DIR="${PANEL_ROOT}/backups"
TEMP_DIR="${PANEL_ROOT}/tmp"

# Database Configuration
readonly USER_DB="${USER_DIR}/users.json"
readonly DB_BACKUP_RETENTION=30
readonly DB_LOCK_TIMEOUT=30

# VPN Configuration
readonly CONFIG_OUTPUT_DIR="${PANEL_ROOT}/generated_configs"
declare -A VPN_EXTENSIONS=(
    ["HTTPCustom"]=".hc"
    ["HTTPInjector"]=".ehi"
    ["DarkTunnel"]=".dark"
    ["ShadowSocks"]=".ss"
    ["OpenVPN"]=".ovpn"
    ["WireGuard"]=".conf"
    ["L2TP"]=".l2tp"
    ["SSTP"]=".sstp"
    ["V2Ray"]=".json"
    ["Trojan"]=".trojan"
)

# Phone Storage Configuration
PHONE_STORAGE_DIR="/mnt/phone/Configs"  # REMOVED readonly
readonly PHONE_MOUNT_POINTS=(
    "/run/user/1000/gvfs/*"
    "/media/${SUDO_USER:-$USER}/*"
    "/mnt/*"
    "/tmp/phone*"
)

# UI Configuration
readonly PANEL_WIDTH=80
readonly PANEL_HEIGHT=25
readonly UI_REFRESH_RATE=2

# Security Configuration
readonly PASSWORD_MIN_LENGTH=8
readonly PASSWORD_MAX_LENGTH=32
readonly USERNAME_PATTERN='^[a-zA-Z][a-zA-Z0-9_-]{2,19}$'
readonly INPUT_TIMEOUT=300
readonly MAX_LOGIN_ATTEMPTS=3
readonly SESSION_TIMEOUT=900

# Logging Configuration
readonly PANEL_LOG="${LOG_DIR}/panel.log"
readonly AUDIT_LOG="${LOG_DIR}/audit.log"
readonly ERROR_LOG="${LOG_DIR}/error.log"
readonly LOG_RETENTION_DAYS=90
readonly LOG_ROTATE_SIZE=10485760

# Service Configuration
readonly SERVICES=("ssh" "xray" "both")
readonly EXPIRY_OPTIONS=("7" "30" "90" "never")
readonly DEFAULT_EXPIRY=30

# Network Configuration
readonly SERVER_IP_API="https://api.ipify.org"
readonly SERVER_IP_FALLBACK="$(hostname -I | awk '{print $1}')"
readonly CONNECTIVITY_CHECK_URL="https://www.google.com"
readonly CONNECTIVITY_TIMEOUT=5

# Color Configuration
readonly RED='\033[0;31m'
readonly GREEN='\033[0;32m'
readonly YELLOW='\033[1;33m'
readonly BLUE='\033[0;34m'
readonly CYAN='\033[0;36m'
readonly MAGENTA='\033[0;35m'
readonly WHITE='\033[1;37m'
readonly BG_BLUE='\033[44m'
readonly BG_GREEN='\033[42m'
readonly BG_RED='\033[41m'
readonly NC='\033[0m'

# Exit Codes
readonly EXIT_SUCCESS=0
readonly EXIT_FAILURE=1
readonly EXIT_INVALID_INPUT=2
readonly EXIT_DB_ERROR=3
readonly EXIT_VALIDATION_ERROR=4
readonly EXIT_SERVICE_ERROR=5
readonly EXIT_PERMISSION_ERROR=6
readonly EXIT_LOCK_ERROR=7

# Load all modules
source "${LIB_DIR}/utils.sh"
source "${LIB_DIR}/validation.sh"
source "${LIB_DIR}/database.sh"
source "${LIB_DIR}/ui.sh"
source "${LIB_DIR}/config-generator.sh"
source "${LIB_DIR}/phone-storage.sh"
source "${LIB_DIR}/audit.sh"
source "${LIB_DIR}/lock.sh"